@model IEnumerable<HR.Domain.Entities.Department>

@{
    ViewData["Title"] = "Departments List";
}

<div class="container-fluid py-4">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col d-flex justify-content-between align-items-center">
            <h2 class="mb-0">@ViewData["Title"]</h2>
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createModal">
                <i class="bi bi-plus-circle me-2"></i>Add Department
            </button>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Name</th>
                            <th>Code</th>
                            <th>Location</th>
                            <th># Employees</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Any())
                        {
                            int i = 1;
                            foreach (var dept in Model)
                            {
                                <tr>
                                    <td>@i</td>
                                    <td>@dept.DepartmentName</td>
                                    <td>@dept.DepartmentCode</td>
                                    <td>@dept.Location</td>
                                    <td>@dept.NumberOfPersonals</td>
                                    <td class="text-end">
                                        <button class="btn btn-outline-dark btn-sm"
                                                data-bs-toggle="modal"
                                                data-bs-target="#editModal"
                                                data-id="@dept.Id"
                                                data-name="@dept.DepartmentName"
                                                data-code="@dept.DepartmentCode"
                                                data-location="@dept.Location"
                                                data-number="@dept.NumberOfPersonals">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm"
                                                data-bs-toggle="modal"
                                                data-bs-target="#deleteModal"
                                                data-id="@dept.Id"
                                                data-name="@dept.DepartmentName">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                i++;
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6" class="text-center py-5 text-muted">No departments found</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- CREATE MODAL -->
<div class="modal fade" id="createModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form method="post" asp-action="Create" class="modal-content border-0 shadow">
            <div class="modal-header bg-success text-white">
                <h6 class="modal-title"><i class="bi bi-plus-circle"></i> Create Department</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <input name="DepartmentName" class="form-control mb-2" placeholder="Name" required />
                <input name="DepartmentCode" class="form-control mb-2" placeholder="Code" required />
                <input name="Location" class="form-control mb-2" placeholder="Location" required />
                <input name="NumberOfPersonals" type="number" class="form-control" placeholder="Number of Employees" value="0" required />
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-success btn-sm">Create</button>
            </div>
        </form>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form method="post" asp-action="Edit" class="modal-content border-0 shadow">
            <input type="hidden" id="edit-id" name="Id" />
            <div class="modal-header bg-dark text-white">
                <h6 class="modal-title"><i class="bi bi-pencil-square"></i> Edit Department</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <input id="edit-name" name="DepartmentName" class="form-control mb-2" required />
                <input id="edit-code" name="DepartmentCode" class="form-control mb-2" required />
                <input id="edit-location" name="Location" class="form-control mb-2" required />
                <input id="edit-number" name="NumberOfPersonals" type="number" class="form-control" required />
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-dark btn-sm">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form method="post" asp-action="Delete" class="modal-content border-0 shadow">
            <input type="hidden" id="delete-id" name="Id" />
            <div class="modal-header bg-danger text-white">
                <h6 class="modal-title"><i class="bi bi-exclamation-triangle"></i> Delete Department</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <p>Are you sure you want to delete <span id="delete-name" class="fw-semibold text-danger"></span>?</p>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </div>
        </form>
    </div>
</div>
<!-- Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div id="liveToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div id="toast-body" class="toast-body">
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Edit modal
    const editModal = document.getElementById('editModal');
    editModal.addEventListener('show.bs.modal', e => {
        const btn = e.relatedTarget;
        document.getElementById('edit-id').value = btn.dataset.id;
        document.getElementById('edit-name').value = btn.dataset.name;
        document.getElementById('edit-code').value = btn.dataset.code;
        document.getElementById('edit-location').value = btn.dataset.location;
        document.getElementById('edit-number').value = btn.dataset.number;
    });

    // Delete modal
    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', e => {
        const btn = e.relatedTarget;
        document.getElementById('delete-id').value = btn.dataset.id;
        document.getElementById('delete-name').textContent = btn.dataset.name;
    });

    // Toast
    const toastEl = document.getElementById('liveToast');
    const toastBody = document.getElementById('toast-body');
    const showToast = (message, type) => {
        toastBody.textContent = message;
        toastEl.className = 'toast align-items-center border-0';
        if(type === 'success') toastEl.classList.add('text-bg-success');
        else if(type === 'error') toastEl.classList.add('text-bg-danger');
        const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
        toast.show();
    };

    @if (TempData["ToastSuccess"] != null)
    {
        <text>showToast("@TempData["ToastSuccess"]", "success");</text>
    }
    @if (TempData["ToastError"] != null)
    {
        <text>showToast("@TempData["ToastError"]", "error");</text>
    }
</script>
}
