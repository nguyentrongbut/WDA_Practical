@model List<HR.Domain.Entities.Employee>

<div class="container-fluid py-4">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1 fw-bold">Employee Management</h2>
                    <p class="text-muted mb-0">Manage all employees</p>
                </div>
                <button type="button"
                        class="btn btn-primary shadow-sm"
                        data-bs-toggle="modal"
                        data-bs-target="#createModal">
                    <i class="bi bi-plus-circle me-2"></i>Add Employee
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Card -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm border-1">
                <div class="card-body">
                    <h6 class="mb-2">Total Employees</h6>
                    <h3 class="mb-0 fw-bold">@Model.Count()</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Table -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th class="px-4 py-3 text-uppercase small fw-semibold">Name</th>
                            <th class="px-4 py-3 text-uppercase small fw-semibold">Code</th>
                            <th class="px-4 py-3 text-uppercase small fw-semibold">Rank</th>
                            <th class="px-4 py-3 text-uppercase small fw-semibold">Department</th>
                            <th class="px-4 py-3 text-uppercase small fw-semibold text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Any())
                        {
                            @foreach (var emp in Model)
                            {
                                <tr>
                                    <td class="px-4 py-3">@emp.EmployeeName</td>
                                    <td class="px-4 py-3">@emp.EmployeeCode</td>
                                    <td class="px-4 py-3">@emp.Rank</td>
                                    <td class="px-4 py-3">@emp.Department?.DepartmentName</td>
                                    <td class="px-4 py-3 text-end">
                                        <div class="d-inline-flex gap-2">
                                            <!-- EDIT -->
                                            <button type="button"
                                                    class="btn btn-outline-dark btn-sm"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#editModal"
                                                    data-id="@emp.Id"
                                                    data-name="@emp.EmployeeName"
                                                    data-code="@emp.EmployeeCode"
                                                    data-rank="@emp.Rank"
                                                    data-department="@emp.DepartmentId"
                                                    title="Edit">
                                                <i class="bi bi-pencil"></i>
                                            </button>

                                            <!-- DELETE -->
                                            <button type="button"
                                                    class="btn btn-outline-danger btn-sm"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#deleteModal"
                                                    data-id="@emp.Id"
                                                    data-name="@emp.EmployeeName"
                                                    title="Delete">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted">
                                    <i class="bi bi-person-x display-4 d-block mb-3"></i>
                                    <p class="mb-0">No employees found. Add your first employee!</p>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- CREATE MODAL -->
<div class="modal fade" id="createModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form method="post" asp-action="Create" class="modal-content border-0 shadow" id="createForm">
            <div class="modal-header bg-primary text-white py-3">
                <h6 class="modal-title fw-semibold mb-0"><i class="bi bi-plus-circle"></i> Create Employee</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-3">
                    <label class="form-label">Name</label>
                    <input name="EmployeeName" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Code</label>
                    <input name="EmployeeCode" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Rank</label>
                    <input name="Rank" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Department</label>
                    <select name="DepartmentId" class="form-control" required>
                        @foreach (var d in ViewBag.Departments)
                        {
                            <option value="@d.Id">@d.DepartmentName</option>
                        }
                    </select>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary btn-sm px-4" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary btn-sm px-4">Create</button>
            </div>
        </form>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form method="post" asp-action="Edit" class="modal-content border-0 shadow" id="editForm">
            <input type="hidden" id="edit-id" name="Id" />
            <div class="modal-header bg-dark text-white py-3">
                <h6 class="modal-title fw-semibold mb-0"><i class="bi bi-pencil-square"></i> Edit Employee</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-3">
                    <label class="form-label">Name</label>
                    <input id="edit-name" name="EmployeeName" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Code</label>
                    <input id="edit-code" name="EmployeeCode" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Rank</label>
                    <input id="edit-rank" name="Rank" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label class="form-label">Department</label>
                    <select id="edit-department" name="DepartmentId" class="form-control" required>
                        @foreach (var d in ViewBag.Departments)
                        {
                            <option value="@d.Id">@d.DepartmentName</option>
                        }
                    </select>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary btn-sm px-4" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-dark btn-sm px-4">Update</button>
            </div>
        </form>
    </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form method="post" asp-action="Delete" class="modal-content border-0 shadow">
            <input type="hidden" id="delete-id" name="Id" />
            <div class="modal-header bg-danger text-white py-3">
                <h6 class="modal-title fw-semibold mb-0"><i class="bi bi-exclamation-triangle"></i> Delete Employee</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <p>Are you sure you want to delete <span id="delete-employee-name" class="fw-semibold text-danger"></span>?</p>
                <small class="text-muted">This action cannot be undone.</small>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-outline-secondary btn-sm px-4" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-danger btn-sm px-4">Delete</button>
            </div>
        </form>
    </div>
</div>  
<!-- TOAST CONTAINER -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <div id="liveToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="toast-body">
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // EDIT modal
        const editModal = document.getElementById('editModal')
        editModal.addEventListener('show.bs.modal', e => {
            const btn = e.relatedTarget
            document.getElementById('edit-id').value = btn.dataset.id
            document.getElementById('edit-name').value = btn.dataset.name
            document.getElementById('edit-code').value = btn.dataset.code
            document.getElementById('edit-rank').value = btn.dataset.rank
            document.getElementById('edit-department').value = btn.dataset.department
        })

        // DELETE modal
        const deleteModal = document.getElementById('deleteModal')
        deleteModal.addEventListener('show.bs.modal', e => {
            const btn = e.relatedTarget
            document.getElementById('delete-id').value = btn.dataset.id
            document.getElementById('delete-employee-name').textContent = btn.dataset.name
        })
        // TOAST
        document.addEventListener('DOMContentLoaded', () => {
            const toastEl = document.getElementById('liveToast')
            const toastBody = document.getElementById('toast-body')

            // Hàm hiển thị toast
            const showToast = (message, type) => {
                toastBody.textContent = message;

                // Reset class màu
                toastEl.classList.remove('text-bg-primary', 'text-bg-danger', 'text-bg-success');

                if (type === 'success') toastEl.classList.add('text-bg-success');
                else if (type === 'error') toastEl.classList.add('text-bg-danger');
                else toastEl.classList.add('text-bg-primary');

                const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                toast.show();
            }

            // Kiểm tra TempData từ Razor
            @* Success *@
            @if (TempData["ToastSuccess"] != null)
            {
            <text>
            showToast("@TempData["ToastSuccess"]", "success");
            </text>
            }

            @* Error *@
            @if (TempData["ToastError"] != null)
            {
            <text>
            showToast("@TempData["ToastError"]", "error");
            </text>
            }
        });
    </script>
}
